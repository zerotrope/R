plot(specimen$log(bili))
plot(log(specimen$bili))
plot(specimen$bili)
plot(log(specimen$albumin))
plot(specimen$albumin)
plot(log(specimen$protime))
plot(specimen$protime)
library(ggplot2)
library(readr)
library(glmnet)
library(survival)
?pbc
#head(pbc)
#summary(pbc)
#hist(pbc$stage)
#table(pbc$stage)
# assign data set to a labelled object
data <- pbc
# create event parameter corresponding to death of the patient
data$event <- 0 + (data$status == 2)
data$trt <- factor(data$trt)
data$status <- factor(data$status)
data$stage <- factor(data$stage)
data$ascites <- factor(data$ascites)
data$edema <- factor(data$edema)
data$spiders <- factor(data$spiders)
hist(data$age)
data$ageGroup <- cut(data$age, breaks = c(0,10,20,30,40,50,60,70,80,90,Inf))
table(data$ageGroup)
# cholesterol
fit.chol <- (lm(chol ~ age, data = data))
data$chol[is.na(data$chol)] <-
predict(fit.chol, newdata = subset(data, is.na(chol)))
# copper
fit.copper <- (lm(copper ~ age, data = data))
data$copper[is.na(data$copper)] <-
predict(fit.copper, newdata = subset(data, is.na(copper)))
# trig
fit.trig <- (lm(trig ~ age, data = data))
data$trig[is.na(data$trig)] <-
predict(fit.trig, newdata = subset(data, is.na(trig)))
# platelet
fit.platelet <- (lm(platelet ~ age, data = data))
data$platelet[is.na(data$platelet)] <-
predict(fit.platelet, newdata = subset(data, is.na(platelet)))
# check if NAs have been properly predicted
summary(data)
specimen <- subset(data, data$trt != "NA" & data$status != 1)
summary(specimen)
survival <- Surv(specimen$time / 365.25, specimen$event)
KM <- survfit(survival ~ 1, data = specimen)
KM
plot(KM, xlab="Survival Years", ylab="Kaplan-Meyer Estimator")
MH <- survdiff(survival ~ specimen$trt)
MH
#plot(MH)
#fit.coxph.test <- coxph(survival ~ ., data = specimen)
fit.coxph <- coxph(survival  ~ age + edema + hepato + platelet + sex + spiders + ascites + log(albumin) + log(alk.phos) + log(ast) + log(bili) + log(chol) + log(copper) + log(trig) + log(protime), data = specimen)
summary(fit.coxph)
#summary(fit.coxph.test)
specimen.null<-data.frame(age=rep(0,1), edema=rep(0,1), bili=rep(1,1), albumin=rep(1,1),protime=rep(1,1))
#plot(survfit(fit.coxph.days, newdata=data.null), lwd=2,ylim=c(.99,1), main='baseline survivor', xlab='Days', ylab='Survival', conf.int=T)
#plot(survfit(fit.coxph.months, newdata=data.null), lwd=2,ylim=c(.99,1), main='baseline survivor', xlab='Months', ylab='Survival', conf.int=T)
plot(survfit(fit.coxph),lwd=2,main= 'fitted survival function at mean covariates', xlab='Years', ylab='Survival')
specimen.null<-data.frame(age=rep(0,1), edema=rep(0,1), bili=rep(1,1), albumin=rep(1,1),protime=rep(1,1))
plot(survfit(fit.coxph, newdata=specimen.null), lwd=2,ylim=c(.99,1), main='baseline survivor', xlab='Years', ylab='Survival', conf.int=T)
fit.coxph2 <- coxph(survival  ~ age + edema + log(albumin) + log(bili) + log(copper) + log(protime), data = specimen)
specimen.null<-data.frame(age=rep(0,1), edema=rep(0,1), bili=rep(1,1), albumin=rep(1,1),protime=rep(1,1))
plot(survfit(fit.coxph2, newdata=specimen.null), lwd=2,ylim=c(.99,1), main='baseline survivor', xlab='Years', ylab='Survival', conf.int=T)
fit.coxph2 <- coxph(survival  ~ age + edema + log(albumin) + log(bili) + log(copper) + log(protime), data = specimen)
specimen.null<-data.frame(age=rep(0,1), edema=rep(0,1), bili=rep(1,1), albumin=rep(1,1), protime=rep(1,1), copper=rep(1,1))
plot(survfit(fit.coxph2, newdata=specimen.null), lwd=2,ylim=c(.99,1), main='baseline survivor', xlab='Years', ylab='Survival', conf.int=T)
fit.coxph2 <- coxph(survival  ~ age + edema + log(albumin) + log(bili) + log(protime), data = specimen)
specimen.null<-data.frame(age=rep(0,1), edema=rep(0,1), bili=rep(1,1), albumin=rep(1,1), protime=rep(1,1))
plot(survfit(fit.coxph2, newdata=specimen.null), lwd=2,ylim=c(.99,1), main='baseline survivor', xlab='Years', ylab='Survival', conf.int=T)
setwd("~/ACADEMICS/DSTI/19 - Survival Analysis/Project")
library(ggplot2)
library(survminer)
library(readr)
library(glmnet)
library(survival)
?pbc
#head(pbc)
#summary(pbc)
#hist(pbc$stage)
#table(pbc$stage)
# assign data set to a labelled object
data <- pbc
# create event parameter corresponding to death of the patient
data$event <- 0 + (data$status == 2)
data$trt <- factor(data$trt)
data$status <- factor(data$status)
data$stage <- factor(data$stage)
data$ascites <- factor(data$ascites)
data$edema <- factor(data$edema)
data$spiders <- factor(data$spiders)
hist(data$age)
data$ageGroup <- cut(data$age, breaks = c(0,10,20,30,40,50,60,70,80,90,Inf))
table(data$ageGroup)
# cholesterol
fit.chol <- (lm(chol ~ age, data = data))
data$chol[is.na(data$chol)] <-
predict(fit.chol, newdata = subset(data, is.na(chol)))
# copper
fit.copper <- (lm(copper ~ age, data = data))
data$copper[is.na(data$copper)] <-
predict(fit.copper, newdata = subset(data, is.na(copper)))
# trig
fit.trig <- (lm(trig ~ age, data = data))
data$trig[is.na(data$trig)] <-
predict(fit.trig, newdata = subset(data, is.na(trig)))
# platelet
fit.platelet <- (lm(platelet ~ age, data = data))
data$platelet[is.na(data$platelet)] <-
predict(fit.platelet, newdata = subset(data, is.na(platelet)))
# check if NAs have been properly predicted
summary(data)
specimen <- subset(data, data$trt != "NA" & data$status != 1)
summary(specimen)
survival <- Surv(specimen$time / 365.25, specimen$event)
KM <- survfit(survival ~ 1, data = specimen)
KM
plot(KM, xlab="Survival Years", ylab="Kaplan-Meyer Estimator")
# fitting the survival to sex parameter
fit.sex <- survfit(survival ~ sex, data = specimen)
## visualizing the survival probability
ggsurvplot(fit.sex,
data = specimen,
xlab = "Years",
conf.int = TRUE,
pval = TRUE,
legend = "top",
legend.title = "Sex",
legend.labs = c("Male", "Female"))
## visualizing the cumulative event
ggsurvplot(fit.sex,
data = specimen,
xlab = "Years",
fun = "event",
legend = "top",
legend.title = "Sex",
legend.labs = c("Male", "Female"))
## visualizing the cumulative hazard
ggsurvplot(fit.sex,
data = specimen,
xlab = "Years",
fun = "cumhaz",
legend = "top",
legend.title = "Sex",
legend.labs = c("Male", "Female"))
# fitting the survival to treatment parameter
fit.sex <- survfit(survival ~ trt, data = specimen)
## visualizing the survival probability
ggsurvplot(fit.trt,
data = specimen,
xlab = "Years",
conf.int = TRUE,
pval = TRUE,
legend = "top",
legend.title = "Sex",
legend.labs = c("Male", "Female"))
library(ggplot2)
library(survminer)
library(readr)
library(glmnet)
library(survival)
?pbc
#head(pbc)
#summary(pbc)
#hist(pbc$stage)
#table(pbc$stage)
# assign data set to a labelled object
data <- pbc
# create event parameter corresponding to death of the patient
data$event <- 0 + (data$status == 2)
data$trt <- factor(data$trt)
data$status <- factor(data$status)
data$stage <- factor(data$stage)
data$ascites <- factor(data$ascites)
data$edema <- factor(data$edema)
data$spiders <- factor(data$spiders)
hist(data$age)
data$ageGroup <- cut(data$age, breaks = c(0,10,20,30,40,50,60,70,80,90,Inf))
table(data$ageGroup)
# cholesterol
fit.chol <- (lm(chol ~ age, data = data))
data$chol[is.na(data$chol)] <-
predict(fit.chol, newdata = subset(data, is.na(chol)))
# copper
fit.copper <- (lm(copper ~ age, data = data))
data$copper[is.na(data$copper)] <-
predict(fit.copper, newdata = subset(data, is.na(copper)))
# trig
fit.trig <- (lm(trig ~ age, data = data))
data$trig[is.na(data$trig)] <-
predict(fit.trig, newdata = subset(data, is.na(trig)))
# platelet
fit.platelet <- (lm(platelet ~ age, data = data))
data$platelet[is.na(data$platelet)] <-
predict(fit.platelet, newdata = subset(data, is.na(platelet)))
# check if NAs have been properly predicted
summary(data)
specimen <- subset(data, data$trt != "NA" & data$status != 1)
summary(specimen)
survival <- Surv(specimen$time / 365.25, specimen$event)
KM <- survfit(survival ~ 1, data = specimen)
KM
plot(KM, xlab="Survival Years", ylab="Kaplan-Meyer Estimator")
# fitting the survival to sex parameter
fit.sex <- survfit(survival ~ sex, data = specimen)
## visualizing the survival probability
ggsurvplot(fit.sex,
data = specimen,
xlab = "Years",
conf.int = TRUE,
pval = TRUE,
legend = "top",
legend.title = "Sex",
legend.labs = c("Male", "Female"))
## visualizing the cumulative event
ggsurvplot(fit.sex,
data = specimen,
xlab = "Years",
fun = "event",
legend = "top",
legend.title = "Sex",
legend.labs = c("Male", "Female"))
## visualizing the cumulative hazard
ggsurvplot(fit.sex,
data = specimen,
xlab = "Years",
fun = "cumhaz",
legend = "top",
legend.title = "Sex",
legend.labs = c("Male", "Female"))
# fitting the survival to treatment parameter
fit.trt <- survfit(survival ~ trt, data = specimen)
## visualizing the survival probability
ggsurvplot(fit.trt,
data = specimen,
xlab = "Years",
conf.int = TRUE,
pval = TRUE,
legend = "top",
legend.title = "Sex",
legend.labs = c("Male", "Female"))
## visualizing the cumulative event
ggsurvplot(fit.trt,
data = specimen,
xlab = "Years",
fun = "event",
legend = "top",
legend.title = "Sex",
legend.labs = c("Male", "Female"))
## visualizing the cumulative hazard
ggsurvplot(fit.trt,
data = specimen,
xlab = "Years",
fun = "cumhaz",
legend = "top",
legend.title = "Sex",
legend.labs = c("Male", "Female"))
MH <- survdiff(survival ~ specimen$trt)
MH
W <- survdiff(survival ~ specimen$trt, rho=1)
W
library(ggplot2)
library(survminer)
library(readr)
library(glmnet)
library(survival)
?pbc
#head(pbc)
#summary(pbc)
#hist(pbc$stage)
#table(pbc$stage)
# assign data set to a labelled object
data <- pbc
# create event parameter corresponding to death of the patient
data$event <- 0 + (data$status == 2)
data$trt <- factor(data$trt)
data$status <- factor(data$status)
data$stage <- factor(data$stage)
data$ascites <- factor(data$ascites)
data$edema <- factor(data$edema)
data$spiders <- factor(data$spiders)
hist(data$age)
data$ageGroup <- cut(data$age, breaks = c(0,10,20,30,40,50,60,70,80,90,Inf))
table(data$ageGroup)
# cholesterol
fit.chol <- (lm(chol ~ age, data = data))
data$chol[is.na(data$chol)] <-
predict(fit.chol, newdata = subset(data, is.na(chol)))
# copper
fit.copper <- (lm(copper ~ age, data = data))
data$copper[is.na(data$copper)] <-
predict(fit.copper, newdata = subset(data, is.na(copper)))
# trig
fit.trig <- (lm(trig ~ age, data = data))
data$trig[is.na(data$trig)] <-
predict(fit.trig, newdata = subset(data, is.na(trig)))
# platelet
fit.platelet <- (lm(platelet ~ age, data = data))
data$platelet[is.na(data$platelet)] <-
predict(fit.platelet, newdata = subset(data, is.na(platelet)))
# check if NAs have been properly predicted
summary(data)
specimen <- subset(data, data$trt != "NA" & data$status != 1)
summary(specimen)
survival <- Surv(specimen$time / 365.25, specimen$event)
KM <- survfit(survival ~ 1, data = specimen)
KM
plot(KM, xlab="Survival Years", ylab="Kaplan-Meyer Estimator")
# fitting the survival to sex parameter
fit.sex <- survfit(survival ~ sex, data = specimen)
## visualizing the survival probability
ggsurvplot(fit.sex,
data = specimen,
xlab = "Years",
conf.int = TRUE,
pval = TRUE,
legend = "top",
legend.title = "Sex",
legend.labs = c("Male", "Female"))
## visualizing the cumulative event
ggsurvplot(fit.sex,
data = specimen,
xlab = "Years",
fun = "event",
legend = "top",
legend.title = "Sex",
legend.labs = c("Male", "Female"))
## visualizing the cumulative hazard
ggsurvplot(fit.sex,
data = specimen,
xlab = "Years",
fun = "cumhaz",
legend = "top",
legend.title = "Sex",
legend.labs = c("Male", "Female"))
# fitting the survival to treatment parameter
fit.trt <- survfit(survival ~ trt, data = specimen)
## visualizing the survival probability
ggsurvplot(fit.trt,
data = specimen,
xlab = "Years",
conf.int = TRUE,
pval = TRUE,
legend = "top",
legend.title = "Sex",
legend.labs = c("Male", "Female"))
## visualizing the cumulative event
ggsurvplot(fit.trt,
data = specimen,
xlab = "Years",
fun = "event",
legend = "top",
legend.title = "Sex",
legend.labs = c("Male", "Female"))
## visualizing the cumulative hazard
ggsurvplot(fit.trt,
data = specimen,
xlab = "Years",
fun = "cumhaz",
legend = "top",
legend.title = "Sex",
legend.labs = c("Male", "Female"))
MH <- survdiff(survival ~ specimen$trt)
MH
W <- survdiff(survival ~ specimen$trt, rho=1)
W
# test ran with all covariates
coxph <- coxph(survival  ~ age + edema + hepato + platelet + sex + spiders + ascites + log(albumin) + log(alk.phos) + log(ast) + log(bili) + log(chol) + log(copper) + log(trig) + log(protime), data = specimen)
summary(coxph)
# fitted test with significant covariate only
fit.coxph <- coxph(survival  ~ age + as.factor(edema) + log(albumin) + log(bili) + log(protime) + log(copper), data = specimen)
summary(fit.coxph)
# fitted test and interactions between covariates
fit.coxph.inter <- coxph(survival  ~ age * as.factor(edema) * log(albumin) * log(bili) * log(protime) * log(copper), data = specimen)
summary(fit.coxph.inter)
library(ggplot2)
library(survminer)
library(readr)
library(glmnet)
library(survival)
?pbc
#head(pbc)
#summary(pbc)
#hist(pbc$stage)
#table(pbc$stage)
# assign data set to a labelled object
data <- pbc
# create event parameter corresponding to death of the patient
data$event <- 0 + (data$status == 2)
data$trt <- factor(data$trt)
data$status <- factor(data$status)
data$stage <- factor(data$stage)
data$ascites <- factor(data$ascites)
data$edema <- factor(data$edema)
data$spiders <- factor(data$spiders)
hist(data$age)
data$ageGroup <- cut(data$age, breaks = c(0,10,20,30,40,50,60,70,80,90,Inf))
table(data$ageGroup)
# cholesterol
fit.chol <- (lm(chol ~ age, data = data))
data$chol[is.na(data$chol)] <-
predict(fit.chol, newdata = subset(data, is.na(chol)))
# copper
fit.copper <- (lm(copper ~ age, data = data))
data$copper[is.na(data$copper)] <-
predict(fit.copper, newdata = subset(data, is.na(copper)))
# trig
fit.trig <- (lm(trig ~ age, data = data))
data$trig[is.na(data$trig)] <-
predict(fit.trig, newdata = subset(data, is.na(trig)))
# platelet
fit.platelet <- (lm(platelet ~ age, data = data))
data$platelet[is.na(data$platelet)] <-
predict(fit.platelet, newdata = subset(data, is.na(platelet)))
# check if NAs have been properly predicted
summary(data)
specimen <- subset(data, data$trt != "NA" & data$status != 1)
summary(specimen)
survival <- Surv(specimen$time / 365.25, specimen$event)
KM <- survfit(survival ~ 1, data = specimen)
KM
plot(KM, xlab="Survival Years", ylab="Kaplan-Meyer Estimator")
# fitting the survival to sex parameter
fit.sex <- survfit(survival ~ sex, data = specimen)
## visualizing the survival probability
ggsurvplot(fit.sex,
data = specimen,
xlab = "Years",
conf.int = TRUE,
pval = TRUE,
legend = "top",
legend.title = "Sex",
legend.labs = c("Male", "Female"))
## visualizing the cumulative event
ggsurvplot(fit.sex,
data = specimen,
xlab = "Years",
fun = "event",
legend = "top",
legend.title = "Sex",
legend.labs = c("Male", "Female"))
## visualizing the cumulative hazard
ggsurvplot(fit.sex,
data = specimen,
xlab = "Years",
fun = "cumhaz",
legend = "top",
legend.title = "Sex",
legend.labs = c("Male", "Female"))
# fitting the survival to treatment parameter
fit.trt <- survfit(survival ~ trt, data = specimen)
## visualizing the survival probability
ggsurvplot(fit.trt,
data = specimen,
xlab = "Years",
conf.int = TRUE,
pval = TRUE,
legend = "top",
legend.title = "Sex",
legend.labs = c("Male", "Female"))
## visualizing the cumulative event
ggsurvplot(fit.trt,
data = specimen,
xlab = "Years",
fun = "event",
legend = "top",
legend.title = "Sex",
legend.labs = c("Male", "Female"))
## visualizing the cumulative hazard
ggsurvplot(fit.trt,
data = specimen,
xlab = "Years",
fun = "cumhaz",
legend = "top",
legend.title = "Sex",
legend.labs = c("Male", "Female"))
MH <- survdiff(survival ~ specimen$trt)
MH
W <- survdiff(survival ~ specimen$trt, rho=1)
W
# test ran with all covariates
coxph <- coxph(survival  ~ age + edema + hepato + platelet + sex + spiders + ascites + log(albumin) + log(alk.phos) + log(ast) + log(bili) + log(chol) + log(copper) + log(trig) + log(protime), data = specimen)
summary(coxph)
# fitted test with significant covariate only
fit.coxph <- coxph(survival  ~ age + as.factor(edema) + log(albumin) + log(bili) + log(protime) + log(copper), data = specimen)
summary(fit.coxph)
# fitted test and interactions between covariates
fit.coxph.inter <- coxph(survival  ~ age * as.factor(edema) * log(albumin) * log(bili) * log(protime) * log(copper), data = specimen)
summary(fit.coxph.inter)
specimen.null<-data.frame(age=rep(0,1), edema=rep(0,1), bili=rep(1,1), albumin=rep(1,1), protime=rep(1,1), copper=rep(1,1))
# for baseline
plot(survfit(fit.coxph, newdata=specimen.null), lwd=2,ylim=c(.99,1), main='Baseline survivor', xlab='Years', ylab='Survival', conf.int=T)
# for mean covariates
plot(survfit(fit.coxph),lwd=2,main= 'Fitted survivor at mean covariates', xlab='Years', ylab='Survival')
ggforest(fit.coxph)
ftest <- cox.zph(fit.coxph)
ftest
ggcoxzph(ftest)
lung$age <- ifelse(lung$age > 70, ">70","<= 70")
fit <- coxph( Surv(time, status) ~ sex + ph.ecog + age, data = lung)
fit
ggforest(fit)
lung$age <- ifelse(pbc$age > 70, ">70","<= 70")
pbc$age <- ifelse(pbc$age > 70, ">70","<= 70")
fit <- coxph( Surv(time, status) ~ sex + age, data = pbc)
fit
ggforest(fit)
