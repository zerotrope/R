setwd("~/ACADEMICS/DSTI/19 - Survival Analysis")
library(reshape)
install.packages("reshape")
install.packages("survival")
library(reshape)
library(maxLik)
library(survival)
dat <- data.frame(ratID = paste0("rat", 1:5),
time = c(55, 50, 70, 120, 110),
failure = c(0, 1, 1, 0, 1),
group = c(0, 1, 0, 1, 1))
sum(dat$failure)
View(dat)
View(dat)
dat <- rename(dat, c(group = 'x'))
dat
dat.events <- subset(dat, failure == 1)
View(dat.events)
View(dat.events)
pLogLik <- function(beta) {
numerator <- with(dat.events, x * beta)
denominator <- rep(NA_real_, length(numerator))
for(j in seq_along(denominator)) {
risk_set <- subset(dat, time >= dat.events[j, "time"])
theta_j <- with(risk_set, exp(x * beta))
denominator[j] <- log(sum(theta_j))
}
return(sum(numerator - denominator))
}
debugonce(pLogLik)
pLoglik(2)
debugonce(pLogLik)
pLogLik(2)
f <- Vectorize(pLogLik)
curve(f, from = -4, to = 4)
fit.ML <- maxLik(pLogLik, start = c(beta = 0))
summary(fit.ML)
fit.cph <- coxph(Surv(time, failure) ~ x, data = dat)
summary(fit.cph)
LRT <- 2 * (fit.ML$maximum - pLogLik(0))
data.frame(LRT = LRT,
pvalue = pchisq(LRT, df = 1, lower.tail = FALSE))
dat <- data.frame(time = c(6, 7, 10, 15, 19, 25),
event = c(1, 0, 1, 1, 0, 1),
age = c(67, 62, 34, 41, 46, 28))
fit <- coxph(Surv(time, event) ~ age, data = dat)
summary(fit)
dat$age_dec <- dat$age / 10
summary(coxph(Surv(time, event) ~ age_dec, data = dat))
library(asaur)
dat <- pharmacoSmoking
head(dat)
fit <- coxph(Surv(ttr, relapse) ~ grp + age + gender + priorAttempts, data = dat)
summary(fit)
View(dat)
View(dat)
fit <- coxph(Surv(ttr, relapse) ~grp + employment, data =dat)
summary(fit)
fit <- coxph(Surv(ttr, relapse) ~ grp + employment, data = dat)
summary(fit)
dat$grp <- relevel(dat$grp, ref = "patchOnly")
fit <- update(fit)
summary(fit)
d <- data.frame(patient = 1:6,
time = c(6, 7, 10, 15, 19, 25),
censored = c(1, 0, 1, 1, 0, 1),
age = c(67, 62, 34, 41, 46, 28))
fit <- coxph(Surv(time, censored)  ~age, data = d)
pred <- survfit(fit, newdata = data.frame(age = c(20, 40, 60)))
plot(pred, col =1;3)
fit <- coxph(Surv(time, censored)  ~age, data = d)
pred <- survfit(fit, newdata = data.frame(age = c(20, 40, 60)))
plot(pred, col =1:3)
library(survival)
dat <- lung
dat$sex <- factor(dat$sex)
help(lung)
View(dat)
View(dat)
summary(dat)
table(dat$status)
getwd()
dat$event <- dat$status - 1
with(dat, table(status, event))
d1 <- subset(dat, select = c(time, event, age, sex, ph.ecog, ph.karno, pat.karno))
d <- na.omit(d1)
summary(d)
View(d)
View(d)
fit.KM <- survit(Surv(time,event) ~ 1, data = d)
fit.KM <- survfit(Surv(time,event) ~ 1, data = d)
fit.KM
table(d$ph.ecog)
d$ph.ecog_binary <- (d$ph.ecog > 0) + 0
d$ph.ecog_binary <- (d$ph.ecog > 0) + 0
d$ph.ecog_binary <- (d$ph.ecog > 0) + 0
with(d, table(ph.ecog, ph.ecog_binary))
<- survfit(Surv(time, event) ~ ph.ecog_binary, data = d)
fit2 <- survfit(Surv(time, event) ~ ph.ecog_binary, data = d)
fit2
plot(fit2, col = 1:2)
survdiff(Surv(time, event) ~ph.ecog_binary, data = d)
fit.cph <- coxph(Surv(time, event) ~ ph.ecog_binary, data = d)
summary(fit.cph)
