setwd("~/ACADEMICS/DSTI/19 - Survival Analysis")
setwd("~/ACADEMICS/DSTI/19 - Survival Analysis")
getwd()
library(survival)
library(asaur)
dat <- pharmacoSmoking
M0 <- coxph(Surv(ttr, relapse) ~ 1, data = dat)
MA <- coxph(Surv(ttr, relapse) ~ ageGroup4, data = dat)
MB <- coxph(Surv(ttr, relapse) ~ employment, data = dat)
MC <- coxph(Surv(ttr, relapse) ~ ageGroup4 + employment, data = dat)
anova(MA, MC)
fits <- list(MA = MA, MB = MB, MC = MC)
sapply(fits, AIC)
AIC(MC)
Mfull <- coxph(Surv(ttr, relapse) ~ grp + gender + race +
employment + yearsSmoking + levelSmoking +
ageGroup4 + priorAttempts + longestNoSmoke,
data = dat)
MAIC <- step(Mfull)
summary(MA)
summary(MAIC)
table(dat$ageGroup4)
install.packages("survivalROC")
library(survivalROC)
data(mayo)
plot(survfit(Surv(time / 365.25, censor) ~ 1, data = mayo))
ROC.4 <- survivalROC(Stime = mayo$time,
status = mayo$censor,
marker = mayo$mayoscore4,
predict.time = 365.25 * 5,
method="KM")
ROC.5 <- survivalROC(Stime = mayo$time,
status = mayo$censor,
marker = mayo$mayoscore5,
predict.time = 365.25,
method = "KM")
View(ROC.4)
View(ROC.4)
ROC <- list(mayo4 = ROC.4, mayo5 = ROC.5)
sapply(ROC, "[[", "AUC")
dfl <- lapply(ROC, function(x) with(x, data.frame(FP, TP)))
for(nm in names(dfl)) {
dfl[[ nm ]]$marker <- nm
}
dat <- do.call(rbind, dfl)
library(ggplot2)
ggplot(dat, aes(FP, TP, color = marker)) +
geom_line() +
theme_bw(base_size = 9)
fit.cph <- coxph(Surv(time, mayoscore5) ~ x, data = mayo)
fit.cph <- coxph(Surv(time, censor) ~ mayoscore5, data = mayo)
summary(fit.cph)
fit2.cph <- coxph(Surv(time, censor) ~ mayoscore4, data = mayo)
summary(fit2.cph)
hist(mayoscore4)
hist(mayo$mayoscore4)
hist(mayo$mayoscore5)
hist(mayo$mayoscore5)
hist(mayo$mayoscore4)
sdScore4 <- mayoscore4/sd(mayoscore4)
sdScore4 <- mayo$mayoscore4/sd(mayo$mayoscore4)
sdScore5 <- mayo$mayoscore5/sd(mayo$mayoscore5)
sd.fit <- coxph(Surv(time, censor) ~ sdScore5, data = mayo)
summary(sd.fit)
sd.fit2 <- coxph(Surv(time, censor) ~ sdScore4, data = mayo)
summary(sd.fit)
cutoff <- with(ROC$mayo5, min(cut.values[FP <= 0.1]))
cutoff
cutoff <- with(ROC$mayo5, min(cut.values[FP <= 0.1]))
cutoff
mayo$prediction <-
ifelse(mayo$mayoscore5 <= cutoff,
"low_risk", "high_risk")
plot(survfit(Surv(time/365, censor) ~ prediction, data = mayo),
col = c("red", "blue"))
library(survival)
library(asaur) ## dataset
data(pharmacoSmoking)
dat <- pharmacoSmoking
library(survival)
library(asaur) ## dataset
data(pharmacoSmoking)
dat <- pharmacoSmoking
fit <- coxph(Surv(ttr, relapse) ~ grp + age + employment, data = dat)
dat$residual <- residuals(fit, type = "martingale")
par(mfrow = c(1, 3), mar = c(4.2, 2, 2, 2))
with(dat, {
plot(age, residual)                           # scatter plot
lines(lowess(age, residual), lwd = 2)         # + smoothing lines
plot(residual ~ grp)                          # boxplot (categorical variable)
plot(residual ~ employment)                   # boxplot (categorical variable)
})
dfbetas <- residuals(fit, type = 'dfbetas')
dat$dfbetas <- sqrt(rowSums(dfbetas^2))
plot(dat$dfbetas, type = 'h')
abline(h = 0)
View(dfbetas)
View(dat)
View(dat)
plot(dat$dfbetas, type = 'h')
abline(h = 0)
library(survival)
library(asaur) ## dataset
library(plyr)
library(ggplot2)
data(pancreatic)
dat <- pancreatic
fmt <- "%m/%d/%Y"
dat <- within(dat, {
onstudy <- as.Date(as.character(onstudy), format = fmt)
progression <- as.Date(as.character(progression), format = fmt)
death <- as.Date(as.character(death), format = fmt)
OS <- death - onstudy
PFS <- pmin(progression - onstudy, OS)
PFS[is.na(PFS)] <- OS[is.na(PFS)]
PFS <- Surv(as.numeric(PFS / 30.5))
OS <- Surv(as.numeric(OS / 30.5))
})
fit <- coxph(PFS ~ stage, data = dat)
summary(fit)
library(survival)
library(asaur)
dat <- pharmacoSmoking
M0 <- coxph(Surv(ttr, relapse) ~ 1, data = dat)
MA <- coxph(Surv(ttr, relapse) ~ ageGroup4, data = dat)
MB <- coxph(Surv(ttr, relapse) ~ employment, data = dat)
MC <- coxph(Surv(ttr, relapse) ~ ageGroup4 + employment, data = dat)
anova(MA, MC)
fits <- list(MA = MA, MB = MB, MC = MC)
sapply(fits, AIC)
AIC(MC)
Mfull <- coxph(Surv(ttr, relapse) ~ grp + gender + race +
employment + yearsSmoking + levelSmoking +
ageGroup4 + priorAttempts + longestNoSmoke,
data = dat)
MAIC <- step(Mfull)
summary(MA)
summary(MAIC)
table(dat$ageGroup4)
library(survivalROC)
data(mayo)
plot(survfit(Surv(time / 365.25, censor) ~ 1, data = mayo))
ROC.4 <- survivalROC(Stime = mayo$time,
status = mayo$censor,
marker = mayo$mayoscore4,
predict.time = 365.25 * 5,
method="KM")
ROC.5 <- survivalROC(Stime = mayo$time,
status = mayo$censor,
marker = mayo$mayoscore5,
predict.time = 365.25 * 5,
method = "KM")
ROC <- list(mayo4 = ROC.4, mayo5 = ROC.5)
sapply(ROC, "[[", "AUC")
dfl <- lapply(ROC, function(x) with(x, data.frame(FP, TP)))
for(nm in names(dfl)) {
dfl[[ nm ]]$marker <- nm
}
dat <- do.call(rbind, dfl)
library(ggplot2)
ggplot(dat, aes(FP, TP, color = marker)) +
geom_line() +
theme_bw(base_size = 9)
fit.cph <- coxph(Surv(time, censor) ~ mayoscore5, data = mayo)
summary(fit.cph)
library(survival)
library(asaur) ## dataset
library(plyr)
library(ggplot2)
data(pancreatic)
dat <- pancreatic
fmt <- "%m/%d/%Y"
dat <- within(dat, {
onstudy <- as.Date(as.character(onstudy), format = fmt)
progression <- as.Date(as.character(progression), format = fmt)
death <- as.Date(as.character(death), format = fmt)
OS <- death - onstudy
PFS <- pmin(progression - onstudy, OS)
PFS[is.na(PFS)] <- OS[is.na(PFS)]
PFS <- Surv(as.numeric(PFS / 30.5))
OS <- Surv(as.numeric(OS / 30.5))
})
fit <- coxph(PFS ~ stage, data = dat)
summary(fit)
fit.KM <- survfit(PFS ~ stage, data = dat)
plot(fit.KM, fun= "cloglog", col = 1:2)
fit.KM <- survfit(Surv(ttr, relapse) ~ grp, data = pharmacoSmoking)
plot(fit.KM, fun = "cloglog", col = 1:2)
fit <- coxph(PFS ~ stage, data = dat)
residual.sch <- cox.zph(fit)
residual.sch
plot(residual.sch)
library(asaur)
d <- pharmacoSmoking
d$employment <- ifelse(d$employment == "ft", "ft", "other")
table(d$employment)
fit <- coxph(Surv(ttr, relapse) ~ grp + strata(employment), data = d)
summary(fit)
library(asaur)
library(survival)
d <- pancreatic2
plot(survfit(Surv(pfs, status) ~ stage, data = d), col = 1:2)
d_WRONG <- subset(d, pfs <= 180)
plot(survfit(Surv(pfs, status) ~ stage, data = d_WRONG), col = 1:2)
d_RIGHT <- within(d, {
status_truncated <- ifelse(pfs > 180, 0, status)
pfs_truncated <- ifelse(pfs > 180, 180, pfs)
})
plot(survfit(Surv(pfs_truncated, status_truncated) ~ stage, data = d_RIGHT),
col = 1:2)
plot(survfit(Surv(pfs, status) ~ stage, data = d_RIGHT),
fun = "cloglog",
col = 1:2)
plot(survfit(Surv(pfs_truncated, status_truncated) ~ stage, data = d_RIGHT),
fun = "cloglog",
col = 1:2)
